<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Coffee Table Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Orbit Controls for user interaction (mouse drag to rotate) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        #scene-container {
            width: 100vw;
            height: 85vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
            touch-action: none;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        #controls-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        .color-group { margin-bottom: 10px; }
        .color-label { font-size: 0.875rem; font-weight: 600; color: #4b5563; }
    </style>
</head>
<body>

    <div class="p-6 bg-white border-b border-gray-200">
        <h1 class="text-2xl font-bold text-gray-900">Interactive 3D Coffee Table</h1>
        <p id="subtitle" class="text-sm text-gray-500 mt-1">Click and drag to rotate the product.</p>
    </div>

    <!-- UI Control Panel -->
    <div id="controls-panel">
        <h2 class="text-lg font-bold mb-3">Customize</h2>
        
        <div class="color-group">
            <label for="frameColor" class="color-label block mb-1">Frame Color:</label>
            <input type="color" id="frameColor" value="#2d3748" class="w-full h-8 p-1 rounded-md border border-gray-300">
        </div>

        <div class="color-group">
            <label for="topColor" class="color-label block mb-1">Tabletop Color:</label>
            <input type="color" id="topColor" value="#e2e8f0" class="w-full h-8 p-1 rounded-md border border-gray-300">
        </div>
    </div>

    <div id="scene-container">
        <!-- The Three.js canvas will be inserted here -->
    </div>

    <script>
        // --- Globals ---
        let scene, camera, renderer, controls, productGroup;
        let container = document.getElementById('scene-container');
        let frameMaterial, topMaterial;

        /**
         * Initializes the Three.js scene, camera, renderer, and lighting.
         */
        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xdddddd); 

            camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 100);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            renderer.shadowMap.enabled = true;

            // Lighting
            scene.add(new THREE.AmbientLight(0x404040, 1.5));
            const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);
            scene.add(hemisphereLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 10, 7.5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // Materials
            frameMaterial = new THREE.MeshStandardMaterial({ 
                color: parseInt(document.getElementById('frameColor').value.substring(1), 16),
                roughness: 0.7,
                metalness: 0.8
            });
            topMaterial = new THREE.MeshStandardMaterial({ 
                color: parseInt(document.getElementById('topColor').value.substring(1), 16),
                roughness: 0.3, 
                metalness: 0.1
            });

            // Event Listeners
            window.addEventListener('resize', onWindowResize, false);
            document.getElementById('frameColor').addEventListener('input', (e) => frameMaterial.color.set(e.target.value));
            document.getElementById('topColor').addEventListener('input', (e) => topMaterial.color.set(e.target.value));
        }

        /**
         * Creates the coffee table model.
         */
        function createCoffeeTable() {
            const group = new THREE.Group();
            const tableHeight = 0.8;
            const tableRadius = 1.0;
            const frameRadius = tableRadius * 0.9;
            const legRadius = 0.03;

            // --- Tabletop ---
            const topGeom = new THREE.CylinderGeometry(tableRadius, tableRadius, 0.05, 64);
            const tabletop = new THREE.Mesh(topGeom, topMaterial);
            tabletop.position.y = tableHeight;
            group.add(tabletop);

            // --- Frame ---
            const frameGroup = new THREE.Group();
            
            // Rings
            const ringGeom = new THREE.TorusGeometry(frameRadius, legRadius, 16, 100);
            const topRing = new THREE.Mesh(ringGeom, frameMaterial);
            topRing.rotation.x = Math.PI / 2;
            topRing.position.y = tableHeight - legRadius * 2;
            
            const bottomRing = new THREE.Mesh(ringGeom, frameMaterial);
            bottomRing.rotation.x = Math.PI / 2;
            bottomRing.position.y = legRadius;
            frameGroup.add(topRing, bottomRing);

            // Legs
            const numLegs = 6;
            const legHeight = tableHeight - legRadius * 3;
            const legGeom = new THREE.CylinderGeometry(legRadius, legRadius, legHeight, 16);
            for (let i = 0; i < numLegs; i++) {
                const angle = (i / numLegs) * Math.PI * 2;
                const leg = new THREE.Mesh(legGeom, frameMaterial);
                leg.position.x = Math.cos(angle) * frameRadius;
                leg.position.z = Math.sin(angle) * frameRadius;
                leg.position.y = legHeight / 2 + legRadius;
                frameGroup.add(leg);
            }
            
            group.add(frameGroup);
            group.position.y = -tableHeight / 2;
            group.traverse(child => { if (child.isMesh) { child.castShadow = true; child.receiveShadow = true; } });
            return group;
        }


        function onWindowResize() {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // --- Main Execution ---
        window.addEventListener('load', () => {
            init();
            
            productGroup = createCoffeeTable();
            scene.add(productGroup);

            // Auto-center and zoom camera
            const box = new THREE.Box3().setFromObject(productGroup);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = camera.fov * (Math.PI / 180);
            let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
            cameraZ *= 2.0; // Padding

            camera.position.set(center.x, center.y + size.y * 0.5, center.z + cameraZ);
            controls.target.copy(center);
            controls.update();

            animate();
        });
    </script>

</body>
</html>
