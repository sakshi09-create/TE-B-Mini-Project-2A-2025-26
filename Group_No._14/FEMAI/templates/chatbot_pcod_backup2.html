<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>PCOS/PCOD Health Assistant</title>-->
<!--    <style>-->
<!--        * {-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            box-sizing: border-box;-->
<!--        }-->

<!--        body {-->
<!--            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);-->
<!--            min-height: 100vh;-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            padding: 20px;-->
<!--        }-->

<!--        .chat-container {-->
<!--            background: rgba(255, 255, 255, 0.95);-->
<!--            backdrop-filter: blur(10px);-->
<!--            border-radius: 20px;-->
<!--            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);-->
<!--            max-width: 450px;-->
<!--            width: 100%;-->
<!--            height: 600px;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .chat-header {-->
<!--            background: linear-gradient(135deg, #ff6b6b, #ee5a24);-->
<!--            color: white;-->
<!--            padding: 20px;-->
<!--            text-align: center;-->
<!--            position: relative;-->
<!--        }-->

<!--        .chat-header::before {-->
<!--            content: '';-->
<!--            position: absolute;-->
<!--            top: 0;-->
<!--            left: 0;-->
<!--            right: 0;-->
<!--            bottom: 0;-->
<!--            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="60" cy="70" r="1" fill="rgba(255,255,255,0.1)"/></svg>');-->
<!--        }-->

<!--        .chat-header h1 {-->
<!--            font-size: 1.5em;-->
<!--            margin-bottom: 5px;-->
<!--            position: relative;-->
<!--        }-->

<!--        .chat-header p {-->
<!--            font-size: 0.9em;-->
<!--            opacity: 0.9;-->
<!--            position: relative;-->
<!--        }-->

<!--        .chat-messages {-->
<!--            flex: 1;-->
<!--            overflow-y: auto;-->
<!--            padding: 20px;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 15px;-->
<!--        }-->

<!--        .welcome-screen {-->
<!--            text-align: center;-->
<!--            padding: 40px 20px;-->
<!--            height: 100%;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            justify-content: center;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .welcome-icon {-->
<!--            font-size: 4em;-->
<!--            margin-bottom: 20px;-->
<!--            color: #667eea;-->
<!--        }-->

<!--        .welcome-screen h2 {-->
<!--            color: #333;-->
<!--            margin-bottom: 15px;-->
<!--            font-size: 1.4em;-->
<!--        }-->

<!--        .welcome-screen p {-->
<!--            color: #666;-->
<!--            margin-bottom: 30px;-->
<!--            line-height: 1.5;-->
<!--        }-->

<!--        .start-btn {-->
<!--            background: linear-gradient(135deg, #667eea, #764ba2);-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 15px 30px;-->
<!--            border-radius: 25px;-->
<!--            font-size: 1.1em;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s ease;-->
<!--            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);-->
<!--        }-->

<!--        .start-btn:hover {-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);-->
<!--        }-->

<!--        .message {-->
<!--            max-width: 85%;-->
<!--            padding: 15px 20px;-->
<!--            border-radius: 20px;-->
<!--            margin-bottom: 10px;-->
<!--            animation: fadeInUp 0.3s ease;-->
<!--        }-->

<!--        .bot-message {-->
<!--            background: linear-gradient(135deg, #667eea, #764ba2);-->
<!--            color: white;-->
<!--            align-self: flex-start;-->
<!--            border-bottom-left-radius: 5px;-->
<!--        }-->

<!--        .user-message {-->
<!--            background: #f1f3f5;-->
<!--            color: #333;-->
<!--            align-self: flex-end;-->
<!--            border-bottom-right-radius: 5px;-->
<!--        }-->

<!--        .options-container {-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            gap: 10px;-->
<!--            margin-top: 15px;-->
<!--        }-->

<!--        .option-btn {-->
<!--            background: white;-->
<!--            border: 2px solid #667eea;-->
<!--            color: #667eea;-->
<!--            padding: 12px 20px;-->
<!--            border-radius: 15px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s ease;-->
<!--            text-align: left;-->
<!--            font-size: 0.95em;-->
<!--        }-->

<!--        .option-btn:hover {-->
<!--            background: #667eea;-->
<!--            color: white;-->
<!--            transform: translateX(5px);-->
<!--        }-->

<!--        .typing-indicator {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            gap: 5px;-->
<!--            padding: 15px 20px;-->
<!--            background: #f1f3f5;-->
<!--            border-radius: 20px;-->
<!--            border-bottom-left-radius: 5px;-->
<!--            align-self: flex-start;-->
<!--            max-width: 80px;-->
<!--        }-->

<!--        .typing-dot {-->
<!--            width: 8px;-->
<!--            height: 8px;-->
<!--            border-radius: 50%;-->
<!--            background: #667eea;-->
<!--            animation: typing 1.4s infinite ease-in-out;-->
<!--        }-->

<!--        .typing-dot:nth-child(2) {-->
<!--            animation-delay: 0.2s;-->
<!--        }-->

<!--        .typing-dot:nth-child(3) {-->
<!--            animation-delay: 0.4s;-->
<!--        }-->

<!--        .progress-bar {-->
<!--            height: 4px;-->
<!--            background: #e9ecef;-->
<!--            border-radius: 2px;-->
<!--            overflow: hidden;-->
<!--            margin: 0 20px 20px;-->
<!--        }-->

<!--        .progress-fill {-->
<!--            height: 100%;-->
<!--            background: linear-gradient(90deg, #667eea, #764ba2);-->
<!--            transition: width 0.3s ease;-->
<!--            border-radius: 2px;-->
<!--        }-->

<!--        @keyframes fadeInUp {-->
<!--            from {-->
<!--                opacity: 0;-->
<!--                transform: translateY(20px);-->
<!--            }-->
<!--            to {-->
<!--                opacity: 1;-->
<!--                transform: translateY(0);-->
<!--            }-->
<!--        }-->

<!--        @keyframes typing {-->
<!--            0%, 60%, 100% {-->
<!--                transform: translateY(0);-->
<!--            }-->
<!--            30% {-->
<!--                transform: translateY(-10px);-->
<!--            }-->
<!--        }-->

<!--        .hidden {-->
<!--            display: none !important;-->
<!--        }-->

<!--        .completion-message {-->
<!--            text-align: center;-->
<!--            padding: 30px;-->
<!--            background: linear-gradient(135deg, #28a745, #20c997);-->
<!--            color: white;-->
<!--            border-radius: 15px;-->
<!--            margin: 20px;-->
<!--        }-->

<!--        .completion-icon {-->
<!--            font-size: 3em;-->
<!--            margin-bottom: 15px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div class="chat-container">-->
<!--        <div class="chat-header">-->
<!--            <h1>ðŸ©º PCOS/PCOD Assistant</h1>-->
<!--            <p>Your Health Companion</p>-->
<!--        </div>-->

<!--        <div class="progress-bar">-->
<!--            <div class="progress-fill" id="progressFill" style="width: 0%"></div>-->
<!--        </div>-->

<!--        <div class="chat-messages" id="chatMessages">-->
<!--            <div class="welcome-screen" id="welcomeScreen">-->
<!--                <div class="welcome-icon">ðŸŒ¸</div>-->
<!--                <h2>Welcome to your Health Assessment</h2>-->
<!--                <p>I'll ask you a few questions to help assess your PCOS/PCOD risk. This assessment is for informational purposes only.</p>-->
<!--                <button class="start-btn" onclick="startChat()">Start Assessment</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script>-->
<!--        let currentQuestion = 0;-->
<!--        let totalQuestions = 7;-->
<!--        let isProcessing = false;-->

<!--        function startChat() {-->
<!--            document.getElementById('welcomeScreen').style.display = 'none';-->

<!--            fetch('/start_chat', {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json',-->
<!--                }-->
<!--            })-->
<!--            .then(response => response.json())-->
<!--            .then(data => {-->
<!--                displayQuestion(data);-->
<!--                updateProgress();-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error('Error:', error);-->
<!--            });-->
<!--        }-->

<!--        function displayQuestion(data) {-->
<!--            const messagesContainer = document.getElementById('chatMessages');-->

<!--            // Add bot message-->
<!--            const botMessage = document.createElement('div');-->
<!--            botMessage.className = 'message bot-message';-->
<!--            botMessage.innerHTML = `-->
<!--                ${data.question}-->
<!--                <div class="options-container">-->
<!--                    ${data.options.map((option, index) =>-->
<!--                        `<button class="option-btn" onclick="selectOption('${option}', '${data.question_id}')">${option}</button>`-->
<!--                    ).join('')}-->
<!--                </div>-->
<!--            `;-->

<!--            messagesContainer.appendChild(botMessage);-->
<!--            messagesContainer.scrollTop = messagesContainer.scrollHeight;-->
<!--        }-->

<!--        function selectOption(answer, questionId) {-->
<!--            if (isProcessing) return;-->
<!--            isProcessing = true;-->

<!--            const messagesContainer = document.getElementById('chatMessages');-->

<!--            // Add user message-->
<!--            const userMessage = document.createElement('div');-->
<!--            userMessage.className = 'message user-message';-->
<!--            userMessage.textContent = answer;-->
<!--            messagesContainer.appendChild(userMessage);-->

<!--            // Remove option buttons from previous question-->
<!--            const optionBtns = document.querySelectorAll('.option-btn');-->
<!--            optionBtns.forEach(btn => btn.style.display = 'none');-->

<!--            // Show typing indicator-->
<!--            const typingIndicator = document.createElement('div');-->
<!--            typingIndicator.className = 'typing-indicator';-->
<!--            typingIndicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';-->
<!--            messagesContainer.appendChild(typingIndicator);-->
<!--            messagesContainer.scrollTop = messagesContainer.scrollHeight;-->

<!--            // Send answer to backend-->
<!--            setTimeout(() => {-->
<!--                fetch('/answer', {-->
<!--                    method: 'POST',-->
<!--                    headers: {-->
<!--                        'Content-Type': 'application/json',-->
<!--                    },-->
<!--                    body: JSON.stringify({-->
<!--                        answer: answer,-->
<!--                        question_id: questionId-->
<!--                    })-->
<!--                })-->
<!--                .then(response => response.json())-->
<!--                .then(data => {-->
<!--                    // Remove typing indicator-->
<!--                    typingIndicator.remove();-->

<!--                    if (data.completed) {-->
<!--                        // Show completion message-->
<!--                        const completionMessage = document.createElement('div');-->
<!--                        completionMessage.className = 'completion-message';-->
<!--                        completionMessage.innerHTML = `-->
<!--                            <div class="completion-icon">âœ…</div>-->
<!--                            <h3>Assessment Complete!</h3>-->
<!--                            <p>Analyzing your responses...</p>-->
<!--                        `;-->
<!--                        messagesContainer.appendChild(completionMessage);-->

<!--                        setTimeout(() => {-->
<!--                            window.location.href = data.redirect;-->
<!--                        }, 2000);-->
<!--                    } else {-->
<!--                        displayQuestion(data);-->
<!--                        currentQuestion++;-->
<!--                        updateProgress();-->
<!--                    }-->

<!--                    messagesContainer.scrollTop = messagesContainer.scrollHeight;-->
<!--                    isProcessing = false;-->
<!--                })-->
<!--                .catch(error => {-->
<!--                    console.error('Error:', error);-->
<!--                    typingIndicator.remove();-->
<!--                    isProcessing = false;-->
<!--                });-->
<!--            }, 1000);-->
<!--        }-->

<!--        function updateProgress() {-->
<!--            const progress = ((currentQuestion + 1) / totalQuestions) * 100;-->
<!--            document.getElementById('progressFill').style.width = progress + '%';-->
<!--        }-->
<!--    </script>-->
<!--</body>-->
<!--</html>-->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCOD Health Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            max-width: 450px;
            width: 100%;
            height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="60" cy="70" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
        }

        .chat-header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
            position: relative;
        }

        .chat-header p {
            font-size: 0.9em;
            opacity: 0.9;
            position: relative;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .welcome-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #667eea;
        }

        .welcome-screen h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .welcome-screen p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 20px;
            margin-bottom: 10px;
            animation: fadeInUp 0.3s ease;
        }

        .bot-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            background: #f1f3f5;
            color: #333;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .option-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.95em;
        }

        .option-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 15px 20px;
            background: #f1f3f5;
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            align-self: flex-start;
            max-width: 80px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        .progress-bar {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin: 0 20px 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .form-container {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 0.95em;
            transition: border-color 0.3s ease;
            background-color: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group select {
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        .hidden {
            display: none !important;
        }

        .completion-message {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #28a745, #20c997);
            <p>Your Health Companion</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-icon">ðŸŒ¸</div>
                <h2>Welcome to your Health Assessment</h2>
                <p>I'll ask you a few questions to help assess your PCOD risk. This assessment is for informational purposes only.</p>
                <button class="start-btn" onclick="startChat()">Start Assessment</button>
            </div>

            <div class="form-container hidden" id="formContainer">
                <form method="POST" action="/predict_pcod" id="pcodForm">
                    <div class="form-group">
                        <label>Age:</label>
                        <input type="number" name="age" required>
                    </div>
                    <div class="form-group">
                        <label>BMI:</label>
                        <input type="text" name="bmi" required>
                    </div>
                    <div class="form-group">
                        <label>Irregular Periods:</label>
                        <select name="irregular" required>
                            <option value="">Select an option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Weight Gain:</label>
                        <select name="weightgain" required>
                            <option value="">Select an option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Excess Hair Growth:</label>
                        <select name="hairgrowth" required>
                            <option value="">Select an option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Acne:</label>
                        <select name="acne" required>
                            <option value="">Select an option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Hair Loss:</label>
                        <select name="hairloss" required>
                            <option value="">Select an option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Family History (Number of family members with PCOD):</label>
                        <input type="number" name="family" required min="0" max="10" placeholder="Enter number (0 if none)">
                    </div>
                    <div class="form-group">
                        <label>Pain:</label>
                        <select name="pain" required>
                            <option value="">Select an option</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">Predict</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        let currentQuestion = 0;
        let totalQuestions = 7;
        let isProcessing = false;

        function startChat() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('formContainer').classList.remove('hidden');
            updateProgress();
        }

        function displayQuestion(data) {
            const messagesContainer = document.getElementById('chatMessages');

            // Add bot message
            const botMessage = document.createElement('div');
            botMessage.className = 'message bot-message';
            botMessage.innerHTML = `
                ${data.question}
                <div class="options-container">
                    ${data.options.map((option, index) =>
                        `<button class="option-btn" onclick="selectOption('${option}', '${data.question_id}')">${option}</button>`
                    ).join('')}
                </div>
            `;

            messagesContainer.appendChild(botMessage);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function selectOption(answer, questionId) {
            if (isProcessing) return;
            isProcessing = true;

            const messagesContainer = document.getElementById('chatMessages');

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.textContent = answer;
            messagesContainer.appendChild(userMessage);

            // Remove option buttons from previous question
            const optionBtns = document.querySelectorAll('.option-btn');
            optionBtns.forEach(btn => btn.style.display = 'none');

            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Send answer to backend
            setTimeout(() => {
                fetch('/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        answer: answer,
                        question_id: questionId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Remove typing indicator
                    typingIndicator.remove();

                    if (data.completed) {
                        // Show completion message
                        const completionMessage = document.createElement('div');
                        completionMessage.className = 'completion-message';
                        completionMessage.innerHTML = `
                            <div class="completion-icon">âœ…</div>
                            <h3>Assessment Complete!</h3>
                            <p>Analyzing your responses...</p>
                        `;
                        messagesContainer.appendChild(completionMessage);

                        setTimeout(() => {
                            window.location.href = data.redirect;
                        }, 2000);
                    } else {
                        displayQuestion(data);
                        currentQuestion++;
                        updateProgress();
                    }

                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    isProcessing = false;
                })
                .catch(error => {
                    console.error('Error:', error);
                    typingIndicator.remove();
                    isProcessing = false;
                });
            }, 1000);
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Form submission with progress update
        document.getElementById('pcodForm').addEventListener('submit', function(e) {
            const fields = this.querySelectorAll('input, select');
            let filled = 0;
            fields.forEach(field => {
                if (field.value) filled++;
            });
            const progress = (filled / fields.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        });

        // Update progress as user fills form
        document.querySelectorAll('#pcodForm input, #pcodForm select').forEach(field => {
            field.addEventListener('input', function() {
                const fields = document.querySelectorAll('#pcodForm input, #pcodForm select');
                let filled = 0;
                fields.forEach(fld => {
                    if (fld.value) filled++;
                });
                const progress = (filled / fields.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            });
            field.addEventListener('change', function() {
                const fields = document.querySelectorAll('#pcodForm input, #pcodForm select');
                let filled = 0;
                fields.forEach(fld => {
                    if (fld.value) filled++;
                });
                const progress = (filled / fields.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            });
        });
    </script>
</body>
</html>