{% extends "base.html" %}

{% block title %}Select Doctor - FEMAI Health{% endblock %}

{% block content %}
<div class="main-container">
    <!-- Header -->
    <div class="text-center mb-4">
        <h1 class="display-5 fw-bold text-primary">
            <i class="fas fa-user-md me-3"></i>
            Select Your Healthcare Professional
        </h1>
        <p class="lead text-muted">
            Choose from our team of PCOS specialists for your consultation
        </p>
    </div>

    <!-- Doctor Cards -->
    <div class="row">
        {% for doctor_id, doctor in doctors.items() %}
        <div class="col-lg-6 col-xl-3 mb-4">
            <div class="feature-card doctor-card h-100">
                <div class="text-center mb-3">
                    <div class="doctor-avatar mb-3">
                        <i class="fas fa-user-md fa-4x text-primary"></i>
                    </div>
                    <h4 class="text-primary mb-1">{{ doctor.name }}</h4>
                    <p class="text-muted mb-2">{{ doctor.specialty }}</p>
                    <div class="rating mb-2">
                        {% for i in range(5) %}
                            {% if i < doctor.rating|int %}
                                <i class="fas fa-star text-warning"></i>
                            {% elif i < doctor.rating %}
                                <i class="fas fa-star-half-alt text-warning"></i>
                            {% else %}
                                <i class="fas fa-star text-muted"></i>
                            {% endif %}
                        {% endfor %}
                        <span class="ms-2 text-muted">({{ doctor.rating }})</span>
                    </div>
                </div>

                <div class="doctor-details mb-3">
                    <div class="row text-center">
                        <div class="col-6">
                            <small class="text-muted d-block">Experience</small>
                            <strong>{{ doctor.experience }}</strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted d-block">Consultation</small>
                            <strong>{{ doctor.consultation_fee }}</strong>
                        </div>
                    </div>
                </div>

                <div class="doctor-info mb-3">
                    <div class="row">
                        <div class="col-12 mb-2">
                            <small class="text-muted d-block">
                                <i class="fas fa-clock me-1"></i>Available Hours
                            </small>
                            <small>{{ doctor.available_hours }}</small><br>
                            <small>{{ doctor.sat_hours }}</small>
                        </div>
                        <div class="col-12 mb-2">
                            <small class="text-muted d-block">
                                <i class="fas fa-language me-1"></i>Languages
                            </small>
                            <small>{{ doctor.languages|join(', ') }}</small>
                        </div>
                        <div class="col-12">
                            <small class="text-muted d-block">
                                <i class="fas fa-envelope me-1"></i>Email
                            </small>
                            <small>{{ doctor.email }}</small>
                        </div>
                    </div>
                </div>

                <div class="doctor-actions">
                    <div class="row g-2">
                        {% if doctor.voice_call_available %}
                        <div class="col-6">
                            <a href="{{ url_for('voice_call', doctor_id=doctor_id) }}" 
                               class="btn btn-outline-primary w-100">
                                <i class="fas fa-phone me-2"></i>Voice Call
                            </a>
                        </div>
                        {% endif %}
                        {% if doctor.video_call_available %}
                        <div class="col-6">
                            <a href="{{ url_for('video_call', doctor_id=doctor_id) }}" 
                               class="btn btn-outline-success w-100">
                                <i class="fas fa-video me-2"></i>Video Call
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="row mt-2">
                        <div class="col-12">
                            <button class="btn btn-outline-info w-100" 
                                    onclick="showDoctorDetails('{{ doctor_id }}')">
                                <i class="fas fa-info-circle me-2"></i>View Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Quick Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="feature-card">
                <h4 class="text-center mb-3">
                    <i class="fas fa-bolt me-2"></i>
                    Quick Actions
                </h4>
                <div class="row text-center">
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-outline-primary btn-lg w-100" onclick="scheduleAppointment()">
                            <i class="fas fa-calendar-plus fa-2x mb-2"></i>
                            <br>Schedule Appointment
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-outline-success btn-lg w-100" onclick="emergencyCall()">
                            <i class="fas fa-ambulance fa-2x mb-2"></i>
                            <br>Emergency Call
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-outline-info btn-lg w-100" onclick="chatWithBot()">
                            <i class="fas fa-robot fa-2x mb-2"></i>
                            <br>Chat with Bot
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Doctor Details Modal -->
<div class="modal fade" id="doctorDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalTitle">
                    <i class="fas fa-user-md me-2"></i>Doctor Details
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="startCallBtn">Start Call</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedDoctor = null;

function showDoctorDetails(doctorId) {
    // Get doctor data from the page
    const doctorCard = document.querySelector(`[onclick="showDoctorDetails('${doctorId}')"]`).closest('.doctor-card');
    const doctorName = doctorCard.querySelector('h4').textContent;
    const doctorSpecialty = doctorCard.querySelector('p').textContent;
    const doctorRating = doctorCard.querySelector('.rating').textContent;
    const doctorExperience = doctorCard.querySelector('.doctor-details strong').textContent;
    const doctorConsultation = doctorCard.querySelectorAll('.doctor-details strong')[1].textContent;
    const doctorHours = doctorCard.querySelectorAll('.doctor-info small')[1].textContent;
    const doctorSatHours = doctorCard.querySelectorAll('.doctor-info small')[2].textContent;
    const doctorLanguages = doctorCard.querySelectorAll('.doctor-info small')[3].textContent;
    const doctorEmail = doctorCard.querySelectorAll('.doctor-info small')[4].textContent;

    // Update modal content
    document.getElementById('modalTitle').innerHTML = `<i class="fas fa-user-md me-2"></i>${doctorName}`;
    
    const modalBody = document.getElementById('modalBody');
    modalBody.innerHTML = `
        <div class="row">
            <div class="col-md-4 text-center">
                <div class="doctor-avatar mb-3">
                    <i class="fas fa-user-md fa-5x text-primary"></i>
                </div>
                <h5 class="text-primary">${doctorName}</h5>
                <p class="text-muted">${doctorSpecialty}</p>
                <div class="rating mb-2">
                    ${doctorRating}
                </div>
            </div>
            <div class="col-md-8">
                <div class="row">
                    <div class="col-6 mb-3">
                        <strong>Experience:</strong><br>
                        <span class="text-muted">${doctorExperience}</span>
                    </div>
                    <div class="col-6 mb-3">
                        <strong>Consultation Fee:</strong><br>
                        <span class="text-muted">${doctorConsultation}</span>
                    </div>
                    <div class="col-12 mb-3">
                        <strong>Available Hours:</strong><br>
                        <span class="text-muted">${doctorHours}<br>${doctorSatHours}</span>
                    </div>
                    <div class="col-6 mb-3">
                        <strong>Languages:</strong><br>
                        <span class="text-muted">${doctorLanguages}</span>
                    </div>
                    <div class="col-6 mb-3">
                        <strong>Email:</strong><br>
                        <span class="text-muted">${doctorEmail}</span>
                    </div>
                </div>
                
                <div class="call-options mt-3">
                    <h6>Call Options:</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <button class="btn btn-outline-primary w-100" onclick="startVoiceCall('${doctorId}')">
                                <i class="fas fa-phone me-2"></i>Voice Call
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-outline-success w-100" onclick="startVideoCall('${doctorId}')">
                                <i class="fas fa-video me-2"></i>Video Call
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

    selectedDoctor = doctorId;
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('doctorDetailsModal'));
    modal.show();
}

function startVoiceCall(doctorId) {
    window.location.href = `/voice-call/${doctorId}`;
}

function startVideoCall(doctorId) {
    window.location.href = `/video-call/${doctorId}`;
}

function scheduleAppointment() {
    alert('Appointment scheduling feature coming soon!');
}

function emergencyCall() {
    window.location.href = '/emergency-call';
}

function chatWithBot() {
    window.location.href = '/chatbot';
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    console.log('Doctor selection page loaded');
});
</script>

<style>
.doctor-card {
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.doctor-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary-color);
    box-shadow: 0 20px 40px rgba(44, 90, 160, 0.15);
}

.doctor-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    color: white;
}

.rating {
    font-size: 0.9rem;
}

.doctor-details {
    border-top: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
    padding: 1rem 0;
}

.doctor-info {
    font-size: 0.9rem;
}

.doctor-actions {
    border-top: 1px solid #dee2e6;
    padding-top: 1rem;
}

.call-options {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 10px;
}
</style>
{% endblock %}
