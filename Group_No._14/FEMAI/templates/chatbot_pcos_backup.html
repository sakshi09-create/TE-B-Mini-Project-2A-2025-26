<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCOS Prediction Chatbot</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: auto; text-align: center; }
        .header { background-color: #007bff; color: white; padding: 20px; border-radius: 10px; }
        .chatbot { background-color: white; padding: 20px; border-radius: 10px; margin-top: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .chatbot h2 { color: #ff6f61; }
        .form-group { margin: 15px 0; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .button { background-color: #ff6f61; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background-color: #e55a50; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ©º PCOS Prediction Chatbot</h1>
            <p>Your Health Companion</p>
        </div>
        <div class="chatbot">
            <h2>ðŸŒ¸ Welcome to your Health Assessment</h2>
            <p>I'll ask you a few questions to help assess your PCOS risk. This assessment is for informational purposes only.</p>
            <form action="/predict_pcos" method="POST">
                <div class="form-group">
                    <label for="age">Age:</label>
                    <input type="number" id="age" name="age" required min="10" max="100" placeholder="Enter your age">
                </div>
                <div class="form-group">
                    <label for="bmi">BMI:</label>
                    <input type="number" id="bmi" name="bmi" step="0.1" required min="10" max="50" placeholder="Enter your BMI">
                </div>
                <div class="form-group">
                    <label for="irregular">Irregular Periods (1=Yes, 0=No):</label>
                    <select id="irregular" name="irregular" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="infertility">Difficulty in Getting Pregnant/Infertility (1=Yes, 0=No):</label>
                    <select id="infertility" name="infertility" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="miscarriage">Miscarriages (Number):</label>
                    <input type="number" id="miscarriage" name="miscarriage" required min="0" max="10" placeholder="Enter number of miscarriages">
                </div>
                <div class="form-group">
                    <label for="hairgrowth">Excess Hair Growth (1=Yes, 0=No):</label>
                    <select id="hairgrowth" name="hairgrowth" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="acne">Acne/Oily Skin (1=Yes, 0=No):</label>
                    <select id="acne" name="acne" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hairloss">Hair Thinning/Hair Loss (1=Yes, 0=No):</label>
                    <select id="hairloss" name="hairloss" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="family">Family History of PCOS (1=Yes, 0=No):</label>
                    <select id="family" name="family" required>
                        <option value="1">Yes</option>
                        <option value="0">No</option>
                    </select>
                </div>
                <button type="submit" class="button">Predict</button>
            </form>
        </div>
    </div>


    <script>
        let currentQuestion = 0;
        let totalQuestions = 7;
        let isProcessing = false;

        function startChat() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('formContainer').classList.remove('hidden');
            updateProgress();
        }

        function displayQuestion(data) {
            const messagesContainer = document.getElementById('chatMessages');

            // Add bot message
            const botMessage = document.createElement('div');
            botMessage.className = 'message bot-message';
            botMessage.innerHTML = `
                ${data.question}
                <div class="options-container">
                    ${data.options.map((option, index) =>
                        `<button class="option-btn" onclick="selectOption('${option}', '${data.question_id}')">${option}</button>`
                    ).join('')}
                </div>
            `;

            messagesContainer.appendChild(botMessage);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function selectOption(answer, questionId) {
            if (isProcessing) return;
            isProcessing = true;

            const messagesContainer = document.getElementById('chatMessages');

            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.textContent = answer;
            messagesContainer.appendChild(userMessage);

            // Remove option buttons from previous question
            const optionBtns = document.querySelectorAll('.option-btn');
            optionBtns.forEach(btn => btn.style.display = 'none');

            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Send answer to backend
            setTimeout(() => {
                fetch('/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        answer: answer,
                        question_id: questionId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // Remove typing indicator
                    typingIndicator.remove();

                    if (data.completed) {
                        // Show completion message
                        const completionMessage = document.createElement('div');
                        completionMessage.className = 'completion-message';
                        completionMessage.innerHTML = `
                            <div class="completion-icon">âœ…</div>
                            <h3>Assessment Complete!</h3>
                            <p>Analyzing your responses...</p>
                        `;
                        messagesContainer.appendChild(completionMessage);

                        setTimeout(() => {
                            window.location.href = data.redirect;
                        }, 2000);
                    } else {
                        displayQuestion(data);
                        currentQuestion++;
                        updateProgress();
                    }

                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    isProcessing = false;
                })
                .catch(error => {
                    console.error('Error:', error);
                    typingIndicator.remove();
                    isProcessing = false;
                });
            }, 1000);
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Form submission with progress update
        document.getElementById('pcodForm').addEventListener('submit', function(e) {
            const inputs = this.querySelectorAll('input');
            let filled = 0;
            inputs.forEach(input => {
                if (input.value) filled++;
            });
            const progress = (filled / inputs.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        });

        // Update progress as user fills form
        document.querySelectorAll('#pcodForm input').forEach(input => {
            input.addEventListener('input', function() {
                const inputs = document.querySelectorAll('#pcodForm input');
                let filled = 0;
                inputs.forEach(inp => {
                    if (inp.value) filled++;
                });
                const progress = (filled / inputs.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            });
        });
    </script>
</body>
</html>